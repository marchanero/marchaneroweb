---
// Importar layout y datos de Google Scholar
import Layout from '../layouts/Layout.astro';
import scholarData from '../data/scholar.json';

// Configuración de la página
export const title = 'Publicaciones - Dr. Roberto Sánchez Reolid';
export const description = 'Publicaciones científicas y métricas bibliométricas del Dr. Roberto Sánchez Reolid, Universidad de Castilla-La Mancha';

// Función para formatear fecha
function formatDate(dateString) {
  return new Date(dateString).toLocaleDateString('es-ES', {
    year: 'numeric',
    month: 'long',
    day: 'numeric'
  });
}

// Función para obtener icono según tipo de publicación
function getPublicationIcon(type) {
  switch (type) {
    case 'journal':
      return '📄';
    case 'conference':
      return '🎤';
    case 'book':
      return '📚';
    case 'thesis':
      return '🎓';
    default:
      return '📄';
  }
}

// Función para obtener color según tipo de publicación
function getPublicationColor(type) {
  switch (type) {
    case 'journal':
      return 'text-blue-600 dark:text-blue-400';
    case 'conference':
      return 'text-green-600 dark:text-green-400';
    case 'book':
      return 'text-purple-600 dark:text-purple-400';
    case 'thesis':
      return 'text-orange-600 dark:text-orange-400';
    default:
      return 'text-gray-600 dark:text-gray-400';
  }
}
---

<Layout title={title} description={description}>
  <main class="min-h-screen bg-white dark:bg-gray-900 transition-colors duration-300">
    <!-- Header de publicaciones -->
    <header class="bg-gradient-to-r from-blue-600 to-indigo-700 dark:from-blue-800 dark:to-indigo-900 text-white py-16">
      <div class="max-w-7xl mx-auto px-4 sm:px-6 lg:px-8">
        <h1 class="text-4xl md:text-5xl font-bold mb-4">
          📚 Publicaciones Científicas
        </h1>
        <p class="text-xl text-blue-100 dark:text-blue-200 max-w-3xl">
          Investigación en Inteligencia Artificial, Machine Learning y Computación Afectiva
        </p>
        <div class="mt-6 text-sm text-blue-200 dark:text-blue-300">
          Última actualización: {formatDate(scholarData.lastUpdated)}
        </div>
      </div>
    </header>

    <div class="max-w-7xl mx-auto px-4 sm:px-6 lg:px-8 py-12">
      
      <!-- Métricas bibliométricas -->
      <section class="mb-12">
        <div class="bg-gray-50 dark:bg-gray-800 rounded-xl p-8 shadow-lg">
          <h2 class="text-2xl font-bold text-gray-900 dark:text-white mb-6 flex items-center">
            📊 Métricas Bibliométricas
          </h2>
          
          <div class="grid grid-cols-1 md:grid-cols-3 gap-6">
            <!-- Total de citas -->
            <div class="bg-white dark:bg-gray-700 rounded-lg p-6 text-center shadow-md">
              <div class="text-3xl font-bold text-blue-600 dark:text-blue-400 mb-2">
                {scholarData.metrics.totalCitations}
              </div>
              <div class="text-gray-600 dark:text-gray-300 font-medium">Total de Citas</div>
              <div class="text-sm text-gray-500 dark:text-gray-400 mt-1">
                ({scholarData.metrics.citationsRecent} desde 2019)
              </div>
            </div>
            
            <!-- Índice h -->
            <div class="bg-white dark:bg-gray-700 rounded-lg p-6 text-center shadow-md">
              <div class="text-3xl font-bold text-green-600 dark:text-green-400 mb-2">
                {scholarData.metrics.hIndex}
              </div>
              <div class="text-gray-600 dark:text-gray-300 font-medium">Índice h</div>
              <div class="text-sm text-gray-500 dark:text-gray-400 mt-1">
                ({scholarData.metrics.hIndexRecent} desde 2019)
              </div>
            </div>
            
            <!-- Índice i10 -->
            <div class="bg-white dark:bg-gray-700 rounded-lg p-6 text-center shadow-md">
              <div class="text-3xl font-bold text-purple-600 dark:text-purple-400 mb-2">
                {scholarData.metrics.i10Index}
              </div>
              <div class="text-gray-600 dark:text-gray-300 font-medium">Índice i10</div>
              <div class="text-sm text-gray-500 dark:text-gray-400 mt-1">
                ({scholarData.metrics.i10IndexRecent} desde 2019)
              </div>
            </div>
          </div>
        </div>
      </section>

      <!-- Información del perfil -->
      <section class="mb-12">
        <div class="bg-white dark:bg-gray-800 rounded-xl p-8 shadow-lg">
          <div class="flex flex-col md:flex-row md:items-center md:justify-between">
            <div>
              <h2 class="text-2xl font-bold text-gray-900 dark:text-white mb-2">
                {scholarData.author.name}
              </h2>
              <p class="text-lg text-gray-600 dark:text-gray-300 mb-4">
                {scholarData.author.affiliation}
              </p>
              <div class="flex flex-wrap gap-2">
                {scholarData.author.interests.map((interest) => (
                  <span class="bg-blue-100 dark:bg-blue-900 text-blue-800 dark:text-blue-200 px-3 py-1 rounded-full text-sm font-medium">
                    {interest}
                  </span>
                ))}
              </div>
            </div>
            <div class="mt-6 md:mt-0">
              <a 
                href={`mailto:${scholarData.author.email}`}
                class="inline-flex items-center px-6 py-3 bg-blue-600 hover:bg-blue-700 dark:bg-blue-700 dark:hover:bg-blue-600 text-white font-medium rounded-lg transition-colors duration-200"
              >
                ✉️ Contactar
              </a>
            </div>
          </div>
        </div>
      </section>

      <!-- Lista de publicaciones -->
      <section>
        <div class="flex items-center justify-between mb-8">
          <h2 class="text-3xl font-bold text-gray-900 dark:text-white">
            Publicaciones ({scholarData.publications.length})
          </h2>
          
          <!-- Filtros -->
          <div class="flex gap-4">
            <select 
              id="yearFilter" 
              class="px-4 py-2 border border-gray-300 dark:border-gray-600 rounded-lg bg-white dark:bg-gray-700 text-gray-900 dark:text-white focus:ring-2 focus:ring-blue-500"
            >
              <option value="">Todos los años</option>
              {[...new Set(scholarData.publications.map(pub => pub.year).filter(Boolean))].sort((a, b) => b - a).map(year => (
                <option value={year}>{year}</option>
              ))}
            </select>
            
            <select 
              id="typeFilter" 
              class="px-4 py-2 border border-gray-300 dark:border-gray-600 rounded-lg bg-white dark:bg-gray-700 text-gray-900 dark:text-white focus:ring-2 focus:ring-blue-500"
            >
              <option value="">Todos los tipos</option>
              <option value="journal">Revistas</option>
              <option value="conference">Conferencias</option>
              <option value="book">Libros</option>
              <option value="thesis">Tesis</option>
            </select>
          </div>
        </div>

        <div class="space-y-6" id="publicationsList">
          {scholarData.publications.map((publication) => (
            <article 
              class="bg-white dark:bg-gray-800 rounded-xl p-6 shadow-lg hover:shadow-xl transition-shadow duration-300 publication-item"
              data-year={publication.year}
              data-type={publication.type}
            >
              <div class="flex flex-col lg:flex-row lg:items-start lg:justify-between">
                <div class="flex-1">
                  <!-- Título -->
                  <h3 class="text-xl font-bold text-gray-900 dark:text-white mb-3 leading-tight">
                    {publication.link ? (
                      <a 
                        href={publication.link} 
                        target="_blank" 
                        rel="noopener noreferrer"
                        class="text-blue-600 dark:text-blue-400 hover:text-blue-800 dark:hover:text-blue-300 transition-colors duration-200"
                      >
                        {publication.title}
                      </a>
                    ) : (
                      publication.title
                    )}
                  </h3>
                  
                  <!-- Autores -->
                  <div class="mb-3">
                    <p class="text-gray-700 dark:text-gray-300">
                      {publication.authors.map((author, index) => (
                        <span>
                          <span class={author.includes('Roberto Sánchez') ? 'font-bold text-blue-600 dark:text-blue-400' : ''}>
                            {author}
                          </span>
                          {index < publication.authors.length - 1 && ', '}
                        </span>
                      ))}
                    </p>
                  </div>
                  
                  <!-- Información de la publicación -->
                  <div class="flex flex-wrap items-center gap-4 mb-3">
                    <span class={`inline-flex items-center px-3 py-1 rounded-full text-sm font-medium ${getPublicationColor(publication.type)} bg-gray-100 dark:bg-gray-700`}>
                      {getPublicationIcon(publication.type)} {publication.type === 'journal' ? 'Revista' : publication.type === 'conference' ? 'Conferencia' : publication.type === 'book' ? 'Libro' : 'Tesis'}
                    </span>
                    
                    {publication.year && (
                      <span class="text-gray-600 dark:text-gray-400 font-medium">
                        📅 {publication.year}
                      </span>
                    )}
                    
                    {publication.citedBy > 0 && (
                      <span class="text-gray-600 dark:text-gray-400">
                        📝 {publication.citedBy} citas
                      </span>
                    )}
                  </div>
                  
                  <!-- Publicación/Venue -->
                  <p class="text-gray-600 dark:text-gray-400 italic mb-3">
                    {publication.publication}
                  </p>
                  
                  <!-- Badges adicionales -->
                  <div class="flex flex-wrap gap-2">
                    {publication.isFirstAuthor && (
                      <span class="bg-green-100 dark:bg-green-900 text-green-800 dark:text-green-200 px-2 py-1 rounded text-xs font-medium">
                        Primer Autor
                      </span>
                    )}
                    {publication.isCorrespondingAuthor && (
                      <span class="bg-purple-100 dark:bg-purple-900 text-purple-800 dark:text-purple-200 px-2 py-1 rounded text-xs font-medium">
                        Autor Correspondiente
                      </span>
                    )}
                  </div>
                </div>
                
                <!-- Enlaces de acción -->
                <div class="mt-4 lg:mt-0 lg:ml-6 flex flex-col gap-2">
                  {publication.link && (
                    <a 
                      href={publication.link} 
                      target="_blank" 
                      rel="noopener noreferrer"
                      class="inline-flex items-center justify-center px-4 py-2 bg-blue-600 hover:bg-blue-700 dark:bg-blue-700 dark:hover:bg-blue-600 text-white text-sm font-medium rounded-lg transition-colors duration-200"
                    >
                      🔗 Ver publicación
                    </a>
                  )}
                  {publication.citedByLink && (
                    <a 
                      href={publication.citedByLink} 
                      target="_blank" 
                      rel="noopener noreferrer"
                      class="inline-flex items-center justify-center px-4 py-2 bg-gray-600 hover:bg-gray-700 dark:bg-gray-700 dark:hover:bg-gray-600 text-white text-sm font-medium rounded-lg transition-colors duration-200"
                    >
                      📊 Ver citas
                    </a>
                  )}
                </div>
              </div>
            </article>
          ))}
        </div>
      </section>

      <!-- Enlaces adicionales -->
      <section class="mt-12 text-center">
        <div class="bg-gradient-to-r from-blue-50 to-indigo-50 dark:from-gray-800 dark:to-gray-700 rounded-xl p-8">
          <h3 class="text-2xl font-bold text-gray-900 dark:text-white mb-4">
            📋 Perfiles Académicos
          </h3>
          <div class="flex flex-wrap justify-center gap-4">
            <a 
              href="https://scholar.google.com" 
              target="_blank" 
              rel="noopener noreferrer"
              class="inline-flex items-center px-6 py-3 bg-red-600 hover:bg-red-700 text-white font-medium rounded-lg transition-colors duration-200"
            >
              🎓 Google Scholar
            </a>
            <a 
              href="https://orcid.org" 
              target="_blank" 
              rel="noopener noreferrer"
              class="inline-flex items-center px-6 py-3 bg-green-600 hover:bg-green-700 text-white font-medium rounded-lg transition-colors duration-200"
            >
              🆔 ORCID
            </a>
            <a 
              href="https://researchgate.net" 
              target="_blank" 
              rel="noopener noreferrer"
              class="inline-flex items-center px-6 py-3 bg-blue-600 hover:bg-blue-700 text-white font-medium rounded-lg transition-colors duration-200"
            >
              🔬 ResearchGate
            </a>
          </div>
        </div>
      </section>
    </div>
  </main>
</Layout>

<script>
  // Funcionalidad de filtros
  document.addEventListener('DOMContentLoaded', function() {
    const yearFilter = document.getElementById('yearFilter');
    const typeFilter = document.getElementById('typeFilter');
    const publicationItems = document.querySelectorAll('.publication-item');

    function filterPublications() {
      const selectedYear = yearFilter.value;
      const selectedType = typeFilter.value;

      publicationItems.forEach(item => {
        const itemYear = item.dataset.year;
        const itemType = item.dataset.type;
        
        const yearMatch = !selectedYear || itemYear === selectedYear;
        const typeMatch = !selectedType || itemType === selectedType;
        
        if (yearMatch && typeMatch) {
          item.style.display = 'block';
        } else {
          item.style.display = 'none';
        }
      });
    }

    yearFilter.addEventListener('change', filterPublications);
    typeFilter.addEventListener('change', filterPublications);
  });
</script>

<style>
  /* Transiciones suaves para el filtrado */
  .publication-item {
    transition: opacity 0.3s ease, transform 0.3s ease;
  }
  
  .publication-item[style*="display: none"] {
    opacity: 0;
    transform: translateY(-10px);
  }
</style>
