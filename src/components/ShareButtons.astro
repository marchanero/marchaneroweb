---
// Componente para compartir contenido académico
interface Props {
  title: string;
  url?: string;
  description?: string;
  type?: 'publication' | 'project' | 'page';
  compact?: boolean;
}

const { 
  title, 
  url = Astro.url.href, 
  description = '',
  type = 'page',
  compact = false
} = Astro.props;

// URLs para compartir
const encodedUrl = encodeURIComponent(url);
const encodedTitle = encodeURIComponent(title);
const encodedDescription = encodeURIComponent(description);

const shareLinks = {
  twitter: `https://twitter.com/intent/tweet?text=${encodedTitle}&url=${encodedUrl}`,
  linkedin: `https://linkedin.com/sharing/share-offsite/?url=${encodedUrl}`,
  email: `mailto:?subject=${encodedTitle}&body=${encodedDescription}%0A%0A${encodedUrl}`,
  mendeley: `https://www.mendeley.com/import/?url=${encodedUrl}`,
  researchgate: `https://www.researchgate.net/publication/share?url=${encodedUrl}`
};

const getIconForPlatform = (platform: string) => {
  const icons = {
    twitter: 'M23 3a10.9 10.9 0 0 1-3.14 1.53 4.48 4.48 0 0 0-7.86 3v1A10.66 10.66 0 0 1 3 4s-4 9 5 13a11.64 11.64 0 0 1-7 2c9 5 20 0 20-11.5a4.5 4.5 0 0 0-.08-.83A7.72 7.72 0 0 0 23 3z',
    linkedin: 'M16 8a6 6 0 0 1 6 6v7h-4v-7a2 2 0 0 0-2-2 2 2 0 0 0-2 2v7h-4v-7a6 6 0 0 1 6-6z M2 9h4v12H2z M4 2a2 2 0 1 1 0 4 2 2 0 0 1 0-4z',
    email: 'M4 4h16c1.1 0 2 .9 2 2v12c0 1.1-.9 2-2 2H4c-1.1 0-2-.9-2-2V6c0-1.1.9-2 2-2z M22 6l-10 7L2 6',
    mendeley: 'M12 2C6.48 2 2 6.48 2 12s4.48 10 10 10 10-4.48 10-10S17.52 2 12 2zm-2 15l-5-5 1.41-1.41L10 14.17l7.59-7.59L19 8l-9 9z',
    researchgate: 'M12 2C6.48 2 2 6.48 2 12s4.48 10 10 10 10-4.48 10-10S17.52 2 12 2zm0 18c-4.41 0-8-3.59-8-8s3.59-8 8-8 8 3.59 8 8-3.59 8-8 8z'
  };
  return icons[platform] || icons.email;
};
---

<div class={`share-component ${compact ? 'compact' : 'full'} ${type}`}>
  {!compact && (
    <h4 class="share-title">
      {type === 'publication' ? '📚 Compartir publicación' : 
       type === 'project' ? '🔬 Compartir investigación' : 
       '🔗 Compartir página'}
    </h4>
  )}
  
  <div class="share-buttons">
    {compact ? (
      <!-- Versión compacta con dropdown -->
      <div class="share-dropdown">
        <button class="share-trigger" aria-label="Opciones para compartir">
          <svg width="20" height="20" fill="none" stroke="currentColor" viewBox="0 0 24 24">
            <circle cx="18" cy="5" r="3"></circle>
            <circle cx="6" cy="12" r="3"></circle>
            <circle cx="18" cy="19" r="3"></circle>
            <line x1="8.59" y1="13.51" x2="15.42" y2="17.49"></line>
            <line x1="15.41" y1="6.51" x2="8.59" y2="10.49"></line>
          </svg>
        </button>
        
        <div class="share-menu">
          {Object.entries(shareLinks).map(([platform, link]) => (
            <a 
              href={link} 
              target="_blank" 
              rel="noopener noreferrer"
              class={`share-link ${platform}`}
              aria-label={`Compartir en ${platform}`}
            >
              <svg width="16" height="16" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d={getIconForPlatform(platform)}></path>
              </svg>
              <span class="sr-only">Compartir en {platform}</span>
            </a>
          ))}
        </div>
      </div>
    ) : (
      <!-- Versión completa con botones visibles -->
      <div class="share-grid">
        {Object.entries(shareLinks).map(([platform, link]) => (
          <a 
            href={link} 
            target="_blank" 
            rel="noopener noreferrer"
            class={`share-button ${platform}`}
            aria-label={`Compartir en ${platform}`}
          >
            <svg width="20" height="20" fill="none" stroke="currentColor" viewBox="0 0 24 24">
              <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d={getIconForPlatform(platform)}></path>
            </svg>
            <span>{platform === 'researchgate' ? 'ResearchGate' : platform.charAt(0).toUpperCase() + platform.slice(1)}</span>
          </a>
        ))}
      </div>
    )}
  </div>
</div>

<style>
  .share-component {
    padding: 1rem;
    border-radius: 0.75rem;
    background: rgba(255, 255, 255, 0.8);
    backdrop-filter: blur(10px);
    border: 1px solid rgba(229, 231, 235, 0.5);
  }
  
  .dark .share-component {
    background: rgba(31, 41, 55, 0.8);
    border-color: rgba(75, 85, 99, 0.5);
  }
  
  .compact {
    padding: 0.5rem;
    background: transparent;
    border: none;
  }
  
  .share-title {
    margin: 0 0 1rem 0;
    font-size: 1rem;
    font-weight: 600;
    color: rgb(55, 65, 81);
  }
  
  .dark .share-title {
    color: rgb(229, 231, 235);
  }
  
  .share-dropdown {
    position: relative;
  }
  
  .share-trigger {
    padding: 0.5rem;
    border-radius: 0.5rem;
    background: rgba(59, 130, 246, 0.1);
    border: 1px solid rgba(59, 130, 246, 0.3);
    color: rgb(59, 130, 246);
    cursor: pointer;
    transition: all 0.2s ease;
  }
  
  .share-trigger:hover {
    background: rgba(59, 130, 246, 0.2);
    transform: translateY(-2px);
  }
  
  .share-menu {
    position: absolute;
    top: 100%;
    right: 0;
    margin-top: 0.5rem;
    background: white;
    border-radius: 0.5rem;
    box-shadow: 0 10px 25px rgba(0, 0, 0, 0.1);
    border: 1px solid rgba(229, 231, 235, 0.5);
    z-index: 50;
    opacity: 0;
    visibility: hidden;
    transform: translateY(-10px);
    transition: all 0.2s ease;
    min-width: 200px;
  }
  
  .dark .share-menu {
    background: rgb(31, 41, 55);
    border-color: rgba(75, 85, 99, 0.5);
  }
  
  .share-dropdown:hover .share-menu {
    opacity: 1;
    visibility: visible;
    transform: translateY(0);
  }
  
  .share-grid {
    display: grid;
    grid-template-columns: repeat(auto-fit, minmax(120px, 1fr));
    gap: 0.75rem;
  }
  
  .share-button,
  .share-link {
    display: flex;
    align-items: center;
    gap: 0.5rem;
    padding: 0.75rem 1rem;
    border-radius: 0.5rem;
    text-decoration: none;
    font-size: 0.875rem;
    font-weight: 500;
    transition: all 0.2s ease;
    border: 1px solid transparent;
  }
  
  .share-link {
    padding: 0.5rem 1rem;
    justify-content: flex-start;
  }
  
  .twitter {
    background: rgba(29, 161, 242, 0.1);
    color: rgb(29, 161, 242);
    border-color: rgba(29, 161, 242, 0.3);
  }
  
  .twitter:hover {
    background: rgba(29, 161, 242, 0.2);
    transform: translateY(-2px);
  }
  
  .linkedin {
    background: rgba(0, 119, 181, 0.1);
    color: rgb(0, 119, 181);
    border-color: rgba(0, 119, 181, 0.3);
  }
  
  .linkedin:hover {
    background: rgba(0, 119, 181, 0.2);
    transform: translateY(-2px);
  }
  
  .email {
    background: rgba(107, 114, 128, 0.1);
    color: rgb(107, 114, 128);
    border-color: rgba(107, 114, 128, 0.3);
  }
  
  .email:hover {
    background: rgba(107, 114, 128, 0.2);
    transform: translateY(-2px);
  }
  
  .mendeley {
    background: rgba(156, 39, 176, 0.1);
    color: rgb(156, 39, 176);
    border-color: rgba(156, 39, 176, 0.3);
  }
  
  .mendeley:hover {
    background: rgba(156, 39, 176, 0.2);
    transform: translateY(-2px);
  }
  
  .researchgate {
    background: rgba(0, 204, 187, 0.1);
    color: rgb(0, 204, 187);
    border-color: rgba(0, 204, 187, 0.3);
  }
  
  .researchgate:hover {
    background: rgba(0, 204, 187, 0.2);
    transform: translateY(-2px);
  }
  
  .sr-only {
    position: absolute;
    width: 1px;
    height: 1px;
    padding: 0;
    margin: -1px;
    overflow: hidden;
    clip: rect(0, 0, 0, 0);
    white-space: nowrap;
    border: 0;
  }
  
  /* Animaciones para el tipo de contenido */
  .publication {
    border-left: 4px solid rgb(59, 130, 246);
  }
  
  .project {
    border-left: 4px solid rgb(16, 185, 129);
  }
  
  .page {
    border-left: 4px solid rgb(139, 92, 246);
  }
  
  @media (max-width: 768px) {
    .share-grid {
      grid-template-columns: repeat(2, 1fr);
    }
    
    .share-button span {
      font-size: 0.75rem;
    }
  }
</style>
